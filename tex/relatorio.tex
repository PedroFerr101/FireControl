% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass[11pt]{article} % use larger type; default would be 10pt

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)
\usepackage[document]{ragged2e}

%%% Examples of Article customizations
% These packages are optional, depending whether you want the features they provide.
% See the LaTeX Companion or other references for full information.

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....
% \geometry{margin=2in} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
%   read geometry.pdf for detailed page layout information

\usepackage[table,xcdraw]{xcolor}

\usepackage{graphicx} % support the \includegraphics command and options
\usepackage{enumerate}

% \usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent

%%% PACKAGES
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
% These packages are all incorporated in the memoir class to one degree or another...

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

\usepackage{xcolor}

%%% SECTION TITLE APPEARANCE
\usepackage{sectsty}
\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
% (This matches ConTeXt defaults)

%%% ToC (table of contents) APPEARANCE
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!
\usepackage{amsmath,amssymb}

%%% END Article customizations

%%% The "real" document content comes below...

\title{Métodos Determinísticos de Investigação Operacional \\ \large Trabalho Prático}
\author{Diogo Sobral, a82523 \\ Henrique Pereira, a80261 \\ Pedro Moreira, a82364 \\ Pedro Ferreira, a81135}
\date{2018/2019}

\begin{document}
\maketitle

\begin{figure*}[!b]
    \centering
    \includegraphics[width=1in]{um_eeng.jpg}
\end{figure*}

\newpage

\section*{Questão 1}
\subsection*{a)}
\textbf{Parâmetros:}  \\
\begin{center}
n - número de nodos existentes \\
c\textsubscript{ij} - tempo de propagação no arco ij\\
i=1,...,n e j=1,...n \\
\end{center}
\textbf{Variáveis de Decisão:} \\
\begin{center}
x\textsubscript{ij} - número de caminhos a que o arco que une os nodos i e j pertence\\
i=1,...,n e j=1,...n \\
\end{center}
\textbf{Função Objetivo:} \\
$$min \ Z = \sum_{i=1}^{n} \sum_{j=1}^{n} c_i_jx_i_j$$
\textbf{Sujeito a:}
\begin{enumerate}[(i)]
\item $$x_i_i = 0, \forall i \in 1,...,n$$
\item $$\sum_{j=2}^{n} (x_1_j - x_j_1) = n-1$$
\item $$\sum_{j=1}^{n} (x_i_j - x_j_i) = -1, \forall i \in 2,...,n $$
\item $$x_i_j \geq 0, \forall i \in 1,...,n , \forall j \in 1,...,n$$
\end{enumerate}\\


Neste modelo, a função objetivo procura que o tempo de chegada do fogo a cada um dos nodos seja o mínimo possível pois serão considerados os arcos de menor custo. Uma vez que a variável de decisão representa o número de caminhos a que o arco ij pertence, o conjunto dos arcos com origem no nodo de ignição, ou seja, no nodo 1,  têm de necessariamente pertencer a todos os caminhos existentes. A restrição (ii) expressa esta condição. Nos restantes nodos, o conjunto dos arcos com origem num determinado nodo i pertencem a menos um caminho que o conjunto dos nodos que chegam a i. Esta situação é definida pela restrição (iii). A equação (i) representa o facto de não existirem arcos cuja origem e destino sejam o mesmo nodo. Por fim, a restrição (iv) estabelece a não negatividade das variáveis.\\
\textcolor{red}{Falta exemplificar com a instância}

\subsection*{b)}

\textbf{Parâmetros:}  \\
\begin{center}
n - número de nodos existentes \\
c\textsubscript{ij} - tempo de propagação no arco ij\\
i=1,...,n e j=1,...n \\
\end{center}
\textbf{Variáveis de Decisão:} \\
\begin{center}
t\textsubscript{i} - tempo decorrido desde a ignição aquando da chegada do fogo ao nodo i\\
i=1,...,n\\
\end{center}
\textbf{Função Objetivo:} \\
$$max \ Z = \sum_{i=1}^{n} t_i$$
\textbf{Sujeito a:}
\begin{enumerate}[(i)]
\item $$t_1 = 0$$
\item $$t_j \leq t_i + t_i_j, \forall i \in 1,...,n , \forall j \in 2,...,n$$
\item $$t_i \geq 0, \forall i \in 1,...,n$$
\end{enumerate}

Enquanto que o modelo primal tinha em consideração o número de caminhos a que um determinado arco pertencia, no modelo duas a variável de decisão representa o momento em que o fogo atinge um determinado nodo. Considerando a ignição no nodo 1, surge a restrição (i). Em conjunto com a função objetivo, a restrição (ii) garante que o tempo de chegada a cada nodo é o mínimo possível, tendo em conta a formulação do problema. Por um lado, queremos maximizar o tempo de chegada a cada nodo (função objetivo), por outro, pela restrição (ii), garante-se que o momento de chegada a um nodo j não é anterior ao menor dos tempos chegada ao conjunto dos nodos adjacentes a j, somado do custo de propagação para este. Por fim, a restrição (iii) estabelece a não negatividade das variáveis.

\textcolor{red}{Falta exemplificar com a instância}

\subsection*{c)}
\textcolor{red}{Obtenha as soluções óptimas primal e dual através da resolução do modelo primal.}

\subsection*{d)}
\textcolor{red}{Obtenha as soluções óptimas primal e dual através da resolução do modelo dual. Confirme que as soluções são as mesmas que as obtidas na alínea anterior, ou, caso não sejam, apresente uma justificação.}

\section*{Questão 2}
\subsection*{a)}
\textbf{Parâmetros:}  \\
\begin{center}
n - número de nodos existentes \\
Q\textsubscript{k} - Nodos adjacentes a k \\
k=1,...,n \\
c\textsubscript{ij} - tempo de propagação no arco ij\\
i=1,...,n e j=1,...n \\
b - número de recursos disponíveis \\
$\Delta$ - constante de retardação \\
ignição - célula de ignição do fogo \\
objetivo - célula a que se pretende atrasar a chegada do fogo
\end{center}

\textbf{Variáveis de Decisão:} \\
\begin{center}
x\textsubscript{i} = \begin{cases} 1, & \mbox{se é aplicado um recurso de proteção na célula i}  \\  0, & \mbox{caso contrário} \end{cases} \\
i=1,...,n \\
t\textsubscript{i} - tempo decorrido desde a ignição aquando da chegada do fogo ao nodo i \\
i=1,...,n \\
\end{center}
\textbf{Função Objetivo:} \\
$$max \ Z = t\textsubscript{$objetivo$}$$ \\

\textbf{Sujeito a:}
\begin{enumerate}[(i)]
\item $$t\textsubscript{ignição} = 0$$
\item $$t_j \leq t_i + c_i_j + \Delta * x_i, \forall i \in Q\textsubscript{j} , \forall j \in 1,...,n$$
\item $$\sum_{i=1}^{n} x_i \leq b$$
\item $$t_i \geq 0, \forall i \in 1,...,n$$
\end{enumerate}
O objetivo do problema é escolher onde aplicar recursos de proteção, que atrasam a propagação do fogo, de forma a retardar o máximo possível o momento de chegada do fogo a um determinado nodo (nodo objetivo). Para alcançar esse fim, consideramos como variável de decisão o tempo de chegada do fogo a cada nodo. Logo, a função objetivo procura maximizar o tempo de chegada ao nodo objetivo. Uma vez que a célula de ignição é um parâmetro do problema e não um valor fixo, temos de associar matematicamente o início do fogo ao nodo de ignição. A restrição (i) garante essa associação. A restrição (ii), em conjunto com a função objetivo, assegura a correta aplicação dos recursos de proteção, em função da célula que queremos proteger. Uma vez que o tempo de chegada do fogo a um certo nodo é definido por recorrência, isto é, o momento de chegada a um nodo j define-se à custa do tempo de chegada a outro nodo e assim sucessivamente até alcançarmos o nodo de ignição, único que se define a si mesmo, o modelo optará por colocar proteções em células que façam parte do caminho percorrido pelo fogo até ao nodo que queremos proteger, maximizando o tempo de chegada a este. A restrição(iii) limita o número de recursos aplicados e a restrição (iv) define a não negatividade das variáveis.
A função objetivo traduz a finalidade pretendida.
\subsection*{b)}
\begin{table}[h]
\centering
\begin{tabular}{cccccccc}
i\textbackslash{}j     & 1                                               & 2                                               & 3                                               & 4                                               & 5                                               & 6                                               & 7                                               \\ \cline{2-8}
\multicolumn{1}{c|}{1} & \multicolumn{1}{c|}{\cellcolor[HTML]{FFFFFF}0}  & \multicolumn{1}{c|}{\cellcolor[HTML]{FFFFFF}13} & \multicolumn{1}{c|}{\cellcolor[HTML]{FFFFFF}25} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}36} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}39} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}42} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}43} \\ \cline{2-8}
\multicolumn{1}{c|}{2} & \multicolumn{1}{c|}{\cellcolor[HTML]{FFFFFF}15} & \multicolumn{1}{c|}{\cellcolor[HTML]{FFFFFF}27} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}39} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}41} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}45} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}48} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}50} \\ \cline{2-8}
\multicolumn{1}{c|}{3} & \multicolumn{1}{c|}{\cellcolor[HTML]{FFFFFF}31} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}41} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}44} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}49} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}51} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}55} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}57} \\ \cline{2-8}
\multicolumn{1}{c|}{4} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}45} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}48} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}52} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}55} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}58} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}61} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}65} \\ \cline{2-8}
\multicolumn{1}{c|}{5} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}52} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}54} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}57} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}62} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}65} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}69} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}72} \\ \cline{2-8}
\multicolumn{1}{c|}{6} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}57} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}60} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}63} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}66} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}71} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}74} & \multicolumn{1}{c|}{\cellcolor[HTML]{FFFFFF}77} \\ \cline{2-8}
\multicolumn{1}{c|}{7} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}59} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}64} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}69} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}73} & \multicolumn{1}{c|}{\cellcolor[HTML]{F8FF00}77} & \multicolumn{1}{c|}{\cellcolor[HTML]{FFFFFF}80} & \multicolumn{1}{c|}{\cellcolor[HTML]{32CB00}92} \\ \cline{2-8}
\end{tabular}
\caption{Representação gráfica da redes de nodos com os tempos da solução obtida.}
\end{table}
\begin{itemize}[$\ast$]
	\item As células a branco representam os nodos onde foram gastos os recursos.
    \item As células a amarelo são nodos normais.
    \item A célula a verde é o nodo a ser protegido.
\end{itemize}
\par Durante o teste deste modelo, deparamo-nos diversas vezes com valores do tempo de chegada do fogo a certas células que eram difíceis de explicar, especialmente quando eram usados poucos recursos. Estes valores levantaram alguma confusão, uma vez que os tempos de chegada do fogo a essas células eram menores do que o suposto. Após vários testes para verificar a robustez do modelo, chegamos à conclusão que os tempos de chegada do fogo a um nodo apenas estavam corretos para aqueles que contribuíam para a solução do problema. Tal acontece pois só são maximizados os tempos de chegada aos nodos que fazem parte do percurso que o fogo realiza até atingir a célula que queremos proteger. De facto, pela função objetivo, estamos a maximizar não só o tempo de chegada à célula objetivo, mas também às restantes que fazem parte do percurso até essa célula, uma vez que a restrição (ii) tem caráter recursivo.
\subsection*{c)}
\begin{figure*}[h]
    \centering
    \includegraphics[scale=0.3]{graf2.png}
    \caption{Gráfico Recursos usados - Tempo de chegada}
\end{figure*}

\par Na figura 1 está representado um gráfico que faz uma associação entre o número de recursos utilizados na proteção e o respetivo tempo de chegada à célula (7,7) (nodo nº 49). Para esta experiência, consideramos o número de recursos disponíveis entre 0 e 8. Como seria expectável, quanto maior o número de recursos disponíveis, mais tarde o fogo atinge a célula objetivo. Inicialmente, sem aplicação de recursos de proteção, o tempo de chegada está situado em 60 e, à medida que aplicamos recursos, varia até 92. As maiores subidas dão-se quando são utilizados  1,5,8 recursos. É de notar que a aplicação de um recurso, neste caso, nunca resulta num incremento do tempo de chegada em 12 unidades de tempo (valor $\Delta$), o que indica a ocorrência de uma mudança no percurso utilizado para atingir a célula objetivo, perante a aplicação de um recurso de proteção. 
\section*{Questão 3}

\subsection*{a)}
\textbf{Parâmetros:}  \\
\begin{center}
n - número de nodos existentes \\
c\textsubscript{ij} - tempo de propagação no arco ij\\
i=1,...,n e j=1,...n \\
t\textsubscript{max} - intervalo de tempo considerado\\
b - número de recursos disponíveis \\
$\Delta$ - constante de retardação \\
p\textsubscript{s} - probabilidade de ignição na célula s\\
s=1,...n \\
\end{center}
\textbf{Variáveis de Decisão:} \\

\begin{center}
x\textsubscript{i} = \begin{cases} 1, & \mbox{se é aplicado um recurso de proteção no nodo i}\\ 0, & \mbox{caso contrário}\end{cases} \\
i=1,...,n \\
t\textsubscript{sj} - tempo decorrido aquando da chegada de um fogo, com origem em s, ao nodo i\\
s=1,...,n e i=1,...,n \\
y\textsubscript{si} = \begin{cases} 1, & \mbox{se o fogo com início no nodo} \ s \ \mbox{chega a} \ i \  \mbox{num tempo inferior a t\textsubscript{max}} \\ 0, & \mbox{caso contrário}\end{cases} \\
s=1,...,n e i=1,...,n
\end{center}

\textbf{Função Objetivo:} \\
$$min \ Z = \sum_{s=1}^{n} \sum_{i=1}^{n} p_sy_s_i$$ \\


\textbf{Sujeito a:}
\begin{enumerate}[(i)]
\item $$t\textsubscript{ss} = 0, \forall s \in 1,...,n$$
\item $$t_s_j \leq t_s_i + d_i_j + \Delta x_i, \forall s \in 1,...n, \forall i \in 1,...,n , \forall j \in 1,...,n$$
\item $$y_s_i \geq \frac{ t\textsubscript{max}-t_s_i}{t\textsubscript{max}}, \forall s \in 1,...,n, \forall i \in 1,...,n $$
\item $$\sum_{i=1}^{n} x_i \leq b$$
\end{enumerate}

O objetivo deste problema é escolher onde aplicar recursos de proteção de forma a minimizar o valor esperado de área ardida, dada a probabilidade de ignição em cada nodo. A resolução deste problema é semelhante à do problema anterior, onde queríamos proteger uma determinada célula. Neste caso, queremos proteger o maior número de células possíveis, consoante o ponto de ignição. Deste modo, introduzimos uma nova variável de decisão, y\textsubscript{si}, que representa o facto de uma célula arder ou não, considerando um período de tempo, e um nodo de ignição do fogo. O objetivo passa por minimizar  o número de células que arderiam se o fogo começasse num nodo s. 
Para obtermos o valor esperado de área ardida, multiplicamos a probabilidade de ignição em s pelo número de células que seriam afetados por um fogo com início nesse nodo. A função objetivo tenta então minimizar o valor obtido pela repetição do cenário descrito em cada um dos nodos existentes. A restrição (i) força o tempo de chegada do fogo ao ponto de ignição a ser zero. A restrição (ii) impede que o tempo de chegada do fogo a um nodo seja inferior que o menor tempo de chegada a um adjacente, somado do tempo de propagação. A restrição (iii), em conjunto com a função objetivo, faz com o que tempo de chegada do fogo a um nodo seja maximizado (enquanto este for inferior a t\textsubscript{max}). Uma vez que queremos minimizar y\textsubscript{si}, temos que aumentar o valor de t\textsubscript{si}. Se  t\textsubscript{si} for igual ou superior a t\textsubscript{max} então o lado direito da restrição (iii) é um valor negativo, pelo que teremos y\textsubscript{si}=0, pois estamos a minimizar o seu valor. Este cenário significa que a célula i não arde se o fogo começar em s. Por outro lado, se t\textsubscript{si} for menor que  t\textsubscript{max} a célula vai arder. Efetivamente, o lado direito da restrição (iii) será um valor positivo, menor ou igual a um e superior a zero, pelo que y\textsubscript{si} só poderá ter valor igual a um. A restrição (iv) limita o número de recursos aplicados. 
\subsection*{b)}
\textcolor{red}{Para a instância em anexo, obtenha uma solução através do IBM ILOG CPLEX
Optimization Studio com probabilidade de ignição na célula (i, j) dada por (14 - i -
j)/500 e intervalo de 12 unidades de tempo. Represente a solução de forma adequada
e interprete-a.}

\subsection*{c)}
\textcolor{red}{Represente graficamente o valor esperado da área ardida em função do intervalo
de tempo considerado. Interprete e comente.}

\end{document}
